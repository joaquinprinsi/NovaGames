{"version":3,"file":"index.umd.cjs","sources":["../src/ticker.ts"],"sourcesContent":["export type Phase = \"head\" | \"update\" | \"render\" | \"tail\";\n\nexport type Listener = (delta: number) => void;\n\nclass Ticker {\n  phases = Object.freeze({\n    head: new Set<Listener>(),\n    update: new Set<Listener>(),\n    render: new Set<Listener>(),\n    tail: new Set<Listener>(),\n  });\n\n  #running: boolean = false;\n\n  get running() {\n    return this.#running;\n  }\n\n  #rafId: number | null = null;\n  #lastTime: number | null = null;\n  #sequence: Phase[] = [\"head\", \"update\", \"render\", \"tail\"];\n\n  private tick = (now: number) => {\n    this.#rafId = requestAnimationFrame(this.tick);\n    const delta = this.#lastTime === null ? 0 : now - this.#lastTime;\n    for (const phase of this.#sequence) {\n      for (const listener of this.phases[phase]) {\n        try {\n          listener(delta);\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    }\n    this.phases.head.clear();\n    this.phases.tail.clear();\n  };\n\n  register(listener: Listener, phase: Phase = \"render\") {\n    this.phases[phase].add(listener);\n  }\n\n  unregister(listener: Listener, phase: Phase = \"render\") {\n    this.phases[phase].delete(listener);\n  }\n\n  start = () => {\n    if (this.running) {\n      console.warn(\"Ticker already running\");\n      return;\n    }\n    this.#running = true;\n    this.tick(performance.now());\n  };\n\n  stop = () => {\n    cancelAnimationFrame(this.#rafId!);\n    this.#rafId = null;\n    this.#running = false;\n  };\n}\n\nexport default Ticker;\n"],"names":["Ticker","#running","#rafId","#lastTime","#sequence","now","delta","phase","listener","err"],"mappings":"gOAIA,MAAMA,CAAO,CAAb,aAAA,CACE,KAAA,OAAS,OAAO,OAAO,CACrB,SAAU,IACV,WAAY,IACZ,WAAY,IACZ,SAAU,GAAc,CACzB,EAEmB,KAAAC,GAAA,GAMI,KAAAC,GAAA,KACG,KAAAC,GAAA,KAC3B,KAAAC,GAAqB,CAAC,OAAQ,SAAU,SAAU,MAAM,EAEhD,KAAA,KAAQC,GAAgB,CACzB,KAAAH,GAAS,sBAAsB,KAAK,IAAI,EAC7C,MAAMI,EAAQ,KAAKH,KAAc,KAAO,EAAIE,EAAM,KAAKF,GAC5C,UAAAI,KAAS,KAAKH,GACvB,UAAWI,KAAY,KAAK,OAAOD,CAAK,EAClC,GAAA,CACFC,EAASF,CAAK,QACPG,EAAK,CACZ,QAAQ,MAAMA,CAAG,CACnB,CAGC,KAAA,OAAO,KAAK,QACZ,KAAA,OAAO,KAAK,OAAM,EAWzB,KAAA,MAAQ,IAAM,CACZ,GAAI,KAAK,QAAS,CAChB,QAAQ,KAAK,wBAAwB,EACrC,MACF,CACA,KAAKR,GAAW,GACX,KAAA,KAAK,YAAY,IAAK,CAAA,CAAA,EAG7B,KAAA,KAAO,IAAM,CACX,qBAAqB,KAAKC,EAAO,EACjC,KAAKA,GAAS,KACd,KAAKD,GAAW,EAAA,CAClB,CA/CAA,GAEA,IAAI,SAAU,CACZ,OAAO,KAAKA,EACd,CAEAC,GACAC,GACAC,GAkBA,SAASI,EAAoBD,EAAe,SAAU,CACpD,KAAK,OAAOA,CAAK,EAAE,IAAIC,CAAQ,CACjC,CAEA,WAAWA,EAAoBD,EAAe,SAAU,CACtD,KAAK,OAAOA,CAAK,EAAE,OAAOC,CAAQ,CACpC,CAgBF"}