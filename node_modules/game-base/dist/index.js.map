{"version":3,"file":"index.js","sources":["../src/ticker.ts"],"sourcesContent":["export type Phase = \"head\" | \"update\" | \"render\" | \"tail\";\n\nexport type Listener = (delta: number) => void;\n\nclass Ticker {\n  phases = Object.freeze({\n    head: new Set<Listener>(),\n    update: new Set<Listener>(),\n    render: new Set<Listener>(),\n    tail: new Set<Listener>(),\n  });\n\n  #running: boolean = false;\n\n  get running() {\n    return this.#running;\n  }\n\n  #rafId: number | null = null;\n  #lastTime: number | null = null;\n  #sequence: Phase[] = [\"head\", \"update\", \"render\", \"tail\"];\n\n  private tick = (now: number) => {\n    this.#rafId = requestAnimationFrame(this.tick);\n    const delta = this.#lastTime === null ? 0 : now - this.#lastTime;\n    for (const phase of this.#sequence) {\n      for (const listener of this.phases[phase]) {\n        try {\n          listener(delta);\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    }\n    this.phases.head.clear();\n    this.phases.tail.clear();\n  };\n\n  register(listener: Listener, phase: Phase = \"render\") {\n    this.phases[phase].add(listener);\n  }\n\n  unregister(listener: Listener, phase: Phase = \"render\") {\n    this.phases[phase].delete(listener);\n  }\n\n  start = () => {\n    if (this.running) {\n      console.warn(\"Ticker already running\");\n      return;\n    }\n    this.#running = true;\n    this.tick(performance.now());\n  };\n\n  stop = () => {\n    cancelAnimationFrame(this.#rafId!);\n    this.#rafId = null;\n    this.#running = false;\n  };\n}\n\nexport default Ticker;\n"],"names":["Ticker","#running","#rafId","#lastTime","#sequence","now","delta","phase","listener","err"],"mappings":"AAIA,MAAMA,EAAO;AAAA,EAAb,cAAA;AACE,SAAA,SAAS,OAAO,OAAO;AAAA,MACrB,0BAAU,IAAc;AAAA,MACxB,4BAAY,IAAc;AAAA,MAC1B,4BAAY,IAAc;AAAA,MAC1B,0BAAU,IAAc;AAAA,IAAA,CACzB,GAEmB,KAAAC,KAAA,IAMI,KAAAC,KAAA,MACG,KAAAC,KAAA,MAC3B,KAAAC,KAAqB,CAAC,QAAQ,UAAU,UAAU,MAAM,GAEhD,KAAA,OAAO,CAACC,MAAgB;AACzB,WAAAH,KAAS,sBAAsB,KAAK,IAAI;AAC7C,YAAMI,IAAQ,KAAKH,OAAc,OAAO,IAAIE,IAAM,KAAKF;AAC5C,iBAAAI,KAAS,KAAKH;AACvB,mBAAWI,KAAY,KAAK,OAAOD,CAAK;AAClC,cAAA;AACF,YAAAC,EAASF,CAAK;AAAA,mBACPG,GAAK;AACZ,oBAAQ,MAAMA,CAAG;AAAA,UACnB;AAGC,WAAA,OAAO,KAAK,SACZ,KAAA,OAAO,KAAK;IAAM,GAWzB,KAAA,QAAQ,MAAM;AACZ,UAAI,KAAK,SAAS;AAChB,gBAAQ,KAAK,wBAAwB;AACrC;AAAA,MACF;AACA,WAAKR,KAAW,IACX,KAAA,KAAK,YAAY,IAAK,CAAA;AAAA,IAAA,GAG7B,KAAA,OAAO,MAAM;AACX,2BAAqB,KAAKC,EAAO,GACjC,KAAKA,KAAS,MACd,KAAKD,KAAW;AAAA,IAAA;AAAA,EAClB;AAAA,EA/CAA;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,KAAKA;AAAA,EACd;AAAA,EAEAC;AAAA,EACAC;AAAA,EACAC;AAAA,EAkBA,SAASI,GAAoBD,IAAe,UAAU;AACpD,SAAK,OAAOA,CAAK,EAAE,IAAIC,CAAQ;AAAA,EACjC;AAAA,EAEA,WAAWA,GAAoBD,IAAe,UAAU;AACtD,SAAK,OAAOA,CAAK,EAAE,OAAOC,CAAQ;AAAA,EACpC;AAgBF;"}